<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Availability Test</title>
</head>

<body>
    <h1>Availability API Test</h1>

    <div id="results"></div>

    <button onclick="testAvailability()">Test Availability</button>

    <script>
        async function testAvailability() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<p>Testing...</p>';

            try {
                // Test 1: Get current availability
                console.log('1. Getting availability...');
                const getResponse = await fetch('/api/barber/availability?barberId=amin&t=' + Date.now(), {
                    cache: 'no-store'
                });
                const currentData = await getResponse.json();
                console.log('Current data:', currentData);

                // Test 2: Save test data
                console.log('2. Saving test data...');
                const testData = {
                    barberId: 'amin',
                    availability: {
                        workingHours: { start: 9, end: 20 },
                        lunchBreak: { start: 13, end: 14 },
                        offDays: ['دوشنبه', 'سه‌شنبه'],
                        offHours: [{ start: '15:00', end: '16:00', date: '' }],
                        isAvailable: true
                    }
                };

                const saveResponse = await fetch('/api/barber/availability', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(testData)
                });
                const saveResult = await saveResponse.json();
                console.log('Save result:', saveResult);

                // Test 3: Verify save
                if (saveResult.success) {
                    console.log('3. Verifying save...');
                    await new Promise(resolve => setTimeout(resolve, 500));

                    const verifyResponse = await fetch('/api/barber/availability?barberId=amin&t=' + Date.now(), {
                        cache: 'no-store'
                    });
                    const verifyData = await verifyResponse.json();
                    console.log('Verify data:', verifyData);

                    resultsDiv.innerHTML = `
                        <h3>✅ Test Results:</h3>
                        <p><strong>Save:</strong> ${saveResult.success ? 'Success' : 'Failed'}</p>
                        <p><strong>Off days saved:</strong> ${JSON.stringify(verifyData.availability?.offDays || [])}</p>
                        <p><strong>Working hours:</strong> ${verifyData.availability?.workingHours?.start}-${verifyData.availability?.workingHours?.end}</p>
                        <pre>${JSON.stringify(verifyData, null, 2)}</pre>
                    `;
                } else {
                    resultsDiv.innerHTML = `<h3>❌ Save Failed:</h3><pre>${JSON.stringify(saveResult, null, 2)}</pre>`;
                }

            } catch (error) {
                console.error('Test error:', error);
                resultsDiv.innerHTML = `<h3>❌ Error:</h3><p>${error.message}</p>`;
            }
        }
    </script>
</body>

</html>